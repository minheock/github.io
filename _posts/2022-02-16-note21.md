---
layout: single
title: '2022-02-16 기록'
---


##Amazon Web Service

####deploy

- Development 단계는 각자의 컴퓨터에서 코드를 작성하고 테스트하는 과정입니다.
개발 단계이기 때문에 실제 데이터를 이용하지 않고 더미 데이터를 이용해서 테스트합니다.

- Integration 단계는 각자의 컴퓨터에서 작성한 코드를 합치는 과정입니다.
내가 작성한 코드가 다른 코드를 침범해서 오류를 일으키지 않는지, 코드 간에 conflict가 있지는 않은지 확인하는 과정을 거칩니다.

- Staging 단계에서는 실제 출시 단계인 Production 단계와 가장 유사한 환경에서 테스트를 진행합니다.
실제 데이터를 복사해서 문제가 있지 않은지 등 다양한 환경에서 테스트를 진행합니다.
또한 서비스와 관련된 부서 혹은 인원의 확인 과정을 거칩니다. 예를 들면 작성된 코드가 마케팅팀 혹은 디자인팀이 예상했던 결과인지 확인을 거치는 과정입니다.

- Production 단계는 개발된 서비스를 출시하는 단계입니다.
사용자가 접속할 수 있는 Production 환경에서 코드를 구동하고 서비스를 제공합니다.
실제 데이터를 가지고 서비스가 운영되기 때문에 문제가 생기면 안 되는 단계입니다.


### pm2
프로세스를 전문적으로 관리해 주는 프로그램을 하나 소개하고자 합니다. 바로 프로세스 매니저(Process Manage) PM2입니다.

PM2는 node.js로 실행되는 프로그램(프로세스)를 관리해 주며, 백그라운드에서 실행되게 만들 수 있습니다.


- 단순히 백그라운드 실행뿐만 아니라 슬라이드에 언급된 것처럼, 다양하고 강력한 기능을 제공합니다.
이중 Hot Reload와 같이 프로그램이 변경될 때 자동으로 재시작하게 도와준다거나, 프로그램 실행 중 에러가 나서 서버가 종료되면, 다시 자동으로 실행시켜주는 기능을 제공합니다.
또한, 서버 운영에서는 필수라고 할 수 있는 로그 관리를 좀 더 전문적으로 할 수 있습니다.
클러스터 모드와 같이 멀티 코어 CPU를 최대한 활용하는 옵션도 있습니다.

- 일반적인 'pm2 start' 명령어로 프로세스를 실행할 경우, 위 화면과 같이 'errored' 상태가 되며 서버가 정상적으로 실행되지 않는 것을 확인할 수 있습니다. 
'pm2 log' 명령어를 통해 어떤 문제가 생겼는지 확인해 봅니다. log를 확인해 보니 pm2가 프로세스를 실행시킬 때 관리자 권한으로 실행하지 못해 생긴 문제로 보입니다. 
PM2에 관리자 권한을 부여하기 위해서는 'authbind'라는 패키지를 추가적으로 설치해야 합니다.


터미널에서 아래 명령어를 차례대로 입력하여 authbind를 설치합니다.
sudo apt-get update

sudo apt-get install authbind

sudo touch /etc/authbind/byport/80

sudo chown ubuntu /etc/authbind/byport/80

sudo chmod 755 /etc/authbind/byport/80

authbind --deep pm2 update

authbind의 설치를 완료한 뒤, 먼저 'pm2 ls' 명령어를 통해 어떤 프로그램이 PM2의 프로세스 리스트에 등록되어 있는지 확인합니다. 

'app' 프로세스가 리스트에 있다면 'pm2 delete [해당파일]' 명령어를 통해 프로세스를 삭제합니다. authbind 설치 전에 실행되고 있던 프로세스에는 관리자 권한을 부여하지 못하기 때문입니다.

PM2에 관리자 권한을 부여하기 위해서는 'authbind --deep' 명령어를 앞에 추가해야 합니다.

 'authbind --deep pm2 start [해당파일]' 명령어를 통해 서버를 다시 실행하면 이번에는 문제없이 작동할 것입니다.